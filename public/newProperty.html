<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Registrar Inmueble</title>
	<link rel="stylesheet" href="./css/styles.css" />
</head>

<body>

	<div class="content">

		<form id="formNewProperty">

			<div class="flexbox column center-v spaced-inner-top spaced-inner-bottom overflow">

				<div class="flexbox row center-h spaced-top">
					<div class="label title-x2">Nuevo inmueble</div>

					<div class="sep x2"></div>
					<div class="sep x2"></div>

					<a class="button" onclick="window.history.back()">Cancelar</a>
					<div class="sep"></div>
					<button class="button black" name="submit" type="submit">
						Registrar inmueble
					</button>
				</div>

				<div class="flexbox row center-h">

					<div class="flexbox column spaced-top">

						<div class="flexbox column block round form">

							<div class="label title">Tipo de inmueble</div>
							<select name="propertyType" class="select" id="formSelector">
								<option value="1">Garaje</option>
								<option value="2">Local comercial</option>
								<option value="3" selected>Vivienda</option>
							</select>

							<div class="label title">Método de venta</div>
							<label onclick="changeMethod()"><input name="propertyMethod" type="checkbox"
									id="propertyMethodS" value="1" />
								<div class="label bold">Venta</div>
							</label>
							<label onclick="changeMethod()"><input name="propertyMethod" type="checkbox"
									id="propertyMethodR" value="2" />
								<div class="label bold">Alquiler</div>
							</label>

							<div class="label title">Estado de inmueble</div>
							<select class="select" name="stdo">
								<option value="1">Obra nueva</option>
								<option value="2">Buen estado</option>
								<option value="3">Reformado</option>
								<option value="4">A reformar</option>
							</select>

							<div class="label title">Energia</div>

							<select class="select" name="energia">
								<option value="1">A++</option>
								<option value="2">A+</option>
								<option value="3">A</option>
								<option value="4">B</option>
								<option value="5">C</option>
								<option value="6">D</option>
								<option value="7">E</option>
								<option value="8">F</option>
								<option value="9">G</option>
							</select>

							<div class="label title">Catastro</div>
							<input class="mode-fill" type="text" name="catast" id="catast"
								placeholder="0000000AA0000A0000AA" required />

							<div class="label title">Dirección</div>
							<textarea class="mode-fill no-resize" name="place" id="place"
								placeholder="AV PRIMADO REIG 151, Escalera 1 Planta 2 Puerta 4"
								required></textarea>
							<div class="label title">Provincia</div>

							<select id="provincias" class="select" name="provincia"></select>

							<div class="label title">Superficie</div>
							<input class="mode-fill" type="text" name="superficie" id="location"
								placeholder="98 m²" value="" required />

							<div class="label title">Precio</div>

							<div class="propertyMethodSPrice hideElement" id="propertyMethodSPrice">
								<div class="label" style="margin-top:16px;">Precio de venta</div>
								<input class="mode-fill" type="text" name="precio" id="precio"
									placeholder="100.000 €" value="" required />
							</div>

							<div class="propertyMethodRPrice hideElement" id="propertyMethodRPrice">
								<div class="label" style="margin-top:16px;">Precio de alquiler (€/mes)</div>
								<input class="mode-fill" type="text" name="precio" id="precio"
									placeholder="700 € / mes" value="" required />
							</div>

							<div class="propertyMethodSPrice" id="propertyMethodNone">
								<div class="label alert" style="margin-top:16px;">Selecciona método de venta
								</div>
							</div>

							<div class="propertyTypeHome" id="propertyTypeHome">

								<div class="sep"></div>

								<div class="label title">Tipo de vivienda</div>
								<select name="homeType" class="select">
									<option value="1">No es vivienda</option>
									<option value="2">Ático</option>
									<option value="3">Plantas intermedias</option>
									<option value="4">Dúplex</option>
									<option value="5">Loft</option>
									<option value="6">Planta Baja</option>
									<option value="7">Casa</option>
									<option value="8">Chalet</option>
									<option value="9">Adosado</option>
									<option value="10">Finca Rústica</option>
								</select>

								<div class="label title">Habitaciones</div>
								<input class="mode-fill" name="roomCount" type="number" min="0" value="0"
									step="1" />

								<div class="label title">Baños</div>
								<input class="mode-fill" name="bathroomCount" type="number" min="0" value="0"
									step="1" />

								<div class="label title optional">Características</div>
								<label><input name="feature" type="checkbox" value="1" />
									<div class="label bold">Ascensor</div>
								</label>
								<label><input name="feature" type="checkbox" value="2" />
									<div class="label bold">Amueblado</div>
								</label>
								<label><input name="feature" type="checkbox" value="3" />
									<div class="label bold">Terraza o balcón</div>
								</label>
								<label><input name="feature" type="checkbox" value="4" />
									<div class="label bold">Aire acondicionado</div>
								</label>
								<label><input name="feature" type="checkbox" value="5" />
									<div class="label bold">Armario empotrado</div>
								</label>
								<label><input name="feature" type="checkbox" value="6" />
									<div class="label bold">Garaje</div>
								</label>
								<label><input name="feature" type="checkbox" value="7" />
									<div class="label bold">Jardín</div>
								</label>
								<label><input name="feature" type="checkbox" value="8" />
									<div class="label bold">Piscina</div>
								</label>
								<label><input name="feature" type="checkbox" value="9" />
									<div class="label bold">Trastero</div>
								</label>

							</div>


							<div class="propertyTypeComercial hideElement" id="propertyTypeComercial">

								<div class="sep"></div>

								<div class="label title">Baños</div>
								<input class="mode-fill" name="bathroomCount" type="number" min="0" value="0"
									step="1" />

							</div>

						</div>

					</div>

					<div class="filters flexbox column spaced-top spaced" style="margin-right:0;">



						<div class="filters flexbox column block round form">
							<div class="label title">Descripcion</div>
							<textarea class="mode-fill no-resize" name="descripcion"
								placeholder="Añade una descripción a tu inmueble" required></textarea>
							<div class="label title">Imágenes <div class="label detail"
									style="margin-left: 6px;"><span id="totalImagesUploaded">0</span> imágenes
								</div>
							</div>

							<div id="dropArea" class="dropArea">
								<input type="file" class="fileInput" id="fileInput" multiple accept="image/*"
									onchange="handleFiles(this.files)">
								<label for="fileInput">
									<p>Suelta imágenes o haz click</p>
									<div class="button" style="display:inline-block;">Seleccionar imágenes
									</div>
								</label>
							</div>
							<div id="gallery" class="gallery empty">
								<div class="imageOptions hide" id="imageOptions"></div>
							</div>

						</div>


					</div>

				</div>

			</div>

		</form>

	</div>

</body>

<script type="text/javascript" src="./registroInmueble.bundle.js"></script>

<script type="text/javascript">

	// Dynamic form

	var formSelector = document.getElementById("formSelector"),
		formSelectorValue = ["", "", "propertyTypeComercial", "propertyTypeHome"],
		propertyMethodS = document.getElementById("propertyMethodS"),
		propertyMethodR = document.getElementById("propertyMethodR"),
		propertyMethodSPrice = document.getElementById("propertyMethodSPrice"),
		propertyMethodRPrice = document.getElementById("propertyMethodRPrice"),
		propertyMethodNone = document.getElementById("propertyMethodNone");

	formSelector.addEventListener("change", changeForm, false);
	propertyMethodS.addEventListener("change", changeMethod, false);
	propertyMethodR.addEventListener("change", changeMethod, false);

	window.onload = () => {
		changeForm();

		propertyMethodS.checked = false;
		propertyMethodR.checked = false;
	}



	function changeForm() {
		console.log(formSelector.value);
		formSelectorValue.forEach(v => {
			if (v != "") document.getElementById(v).classList.add("hideElement");
		});
		if (formSelector.value != 1) document.getElementById(formSelectorValue[formSelector.value]).classList.remove("hideElement");
	}

	function changeMethod() {
		if (propertyMethodS.checked && propertyMethodR.checked) {
			// both checked
			propertyMethodSPrice.classList.remove("hideElement");
			propertyMethodRPrice.classList.remove("hideElement");
			propertyMethodNone.classList.add("hideElement");
		} else if (propertyMethodS.checked && !propertyMethodR.checked) {
			// sell
			propertyMethodSPrice.classList.remove("hideElement");
			propertyMethodRPrice.classList.add("hideElement");
			propertyMethodNone.classList.add("hideElement");
		} else if (propertyMethodR.checked && !propertyMethodS.checked) {
			// rent
			propertyMethodSPrice.classList.add("hideElement");
			propertyMethodRPrice.classList.remove("hideElement");
			propertyMethodNone.classList.add("hideElement");

		} else {
			// none selected
			propertyMethodSPrice.classList.add("hideElement");
			propertyMethodRPrice.classList.add("hideElement");
			propertyMethodNone.classList.remove("hideElement");
		}
	}

	// Image upload

	var dropArea = document.querySelector("#dropArea"),
		totalImages = 0,
		totalImagesDIV = document.getElementById("totalImagesUploaded"),
		imageGallery = {};

	// Prevent default drag behaviors
	["dragenter", "dragover", "dragleave", "drop"].forEach(eventName => {
		dropArea.addEventListener(eventName, preventDefaults, false)
		document.body.addEventListener(eventName, preventDefaults, false)
	});

	// Highlight drop area when item is dragged over it
	// When enter or hover
	["dragenter", "dragover"].forEach(eventName => {
		dropArea.addEventListener(eventName, highlight, false);
	});
	// When leave or drop
	["dragleave", "drop"].forEach(eventName => {
		dropArea.addEventListener(eventName, unhighlight, false);
	});

	// Handle dropped files
	dropArea.addEventListener("drop", handleDrop, false);

	function preventDefaults(e) {
		e.preventDefault();
		e.stopPropagation();
	}

	function highlight(e) {
		dropArea.classList.add("highlight");
	}

	function unhighlight(e) {
		dropArea.classList.remove("highlight");
	}

	function handleDrop(e) {
		handleFiles(e.dataTransfer.files);
	}

	function handleFiles(files) {
		files = [...files];
		files.forEach(file => {
			if (file.type.match("image.*") && !file.type.match("image/svg")) {
				previewFile(file);
			} else {
				console.warn("The file you are trying to upload is not a image! (file is: %s)", file.type.split("/")[1]);
			}
		})
	}

	function previewFile(file) {
		let reader = new FileReader();
		reader.readAsDataURL(file);
		reader.onloadend = function () {
			addImage(reader.result);
		};
	}

	function addImage(url) {
		let img = document.createElement("img"),
			imageId = convertToCharCode(Date.now() * Math.random());
		img.src = url;
		img.id = imageId;
		img.style.cssText = "width:180px;margin:5px;border-radius:6px;cursor:pointer;";
		// Add to DOM
		document.querySelector("#gallery").appendChild(img);
		// Add to image gallery object
		imageGallery[imageId] = img.src;
		// Increment image count
		totalImagesDIV.textContent = ++totalImages;
		if (totalImages > 0) {
			gallery.classList.remove("empty");
		}
	}

	function addImages(imgs) {
		imgs.forEach(img => addImage(img));
	}

	function convertToCharCode(num) {
		return num
			.toString()    // convert number to string
			.split('')     // convert string to array of characters
			.map(Number)   // parse characters as numbers
			.map(n => (n || 10) + 64)   // convert to char code, correcting for J
			.map(c => String.fromCharCode(c))   // convert char codes to strings
			.join('');     // join values together
	}

	var gallery = document.querySelector("#gallery"),
		imageOptions = document.querySelector("#imageOptions");
	gallery.addEventListener("mousemove", detectImage);
	gallery.addEventListener("click", removeImage);
	gallery.addEventListener("mouseleave", hideImageOptions);

	var tmpTarget;
	function detectImage(e) {
		if (e.target.id != tmpTarget) {
			if (e.target.tagName == "IMG") {
				showImageOptions(e.target.id)
			} else hideImageOptions();
		}
		tmpTarget = e.target.id;
	}

	function showImageOptions(id) {
		var pos = document.getElementById(id).getBoundingClientRect();
		imageOptions.style.top = pos.top - gallery.getBoundingClientRect().top + "px";
		imageOptions.style.left = pos.left - gallery.getBoundingClientRect().left + "px";
		imageOptions.style.width = pos.width + "px";
		imageOptions.style.height = pos.height + "px";
		imageOptions.classList.remove("hide");
	}

	function removeImage(e) {
		if (e.target.tagName == "IMG") {
			// Hide image options overlay
			hideImageOptions();
			// Remove from DOM
			e.target.remove();
			// Remove from image gallery object
			delete imageGallery[e.target.id];
			// Decrement image number
			totalImagesDIV.textContent = --totalImages;
			if (totalImages == 0) gallery.classList.add("empty");
		}
	}

	function hideImageOptions() {
		tmpTarget = "";
		imageOptions.classList.add("hide");
	}



</script>

</html>