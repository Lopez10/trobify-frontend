<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Crear cuenta</title>
	<link rel="stylesheet" href="./css/styles.css" />
</head>

<body>
	<div class="content">

		<div class="flexbox column center-v">

			<nav class="flexbox row center-v">
				<a href="index.html" class="logo"></a>

				<div class="links">
					<a href="login.html" class="link button black">Iniciar sesión</a>
				</div>

			</nav>

			<div class="steps flexbox row">
				<div class="step" stepNumber="1" stepLabel="Datos personales"><span></span></div>
				<div class="step" stepNumber="2" stepLabel="Contacto"><span></span></div>
				<div class="step" stepNumber="3" stepLabel="Cuenta"><span></span></div>
			</div>

			<div class="flexbox column block round form spaced-bottom">

				<form id="formSignUp" formFilter>

					<div class="stepContent" stepContent="1">

						<div class="dynamicFilter" filterType="input">
							<div class="label title required">Nombre</div>
							<input filter class="mode-fill" type="text" name="nombre" id="name"
								placeholder="John" required autofocus />
							<div class="label small alert alertMessage hideElement" style="margin-top: 10px;"
								id="alertName">El campo nombre no puede estar vacío</div>
						</div>

						<div class="dynamicFilter" filterType="input">
							<div class="sep x0"></div>

							<div class="label title">Apellidos</div>
							<input filter class="mode-fill" type="text" name="apellidos" id="lastName"
								placeholder="Appleseed" required autofocus />
						</div>

						<div class="dynamicFilter">
							<label><input name="adult" id="adult" type="checkbox" value="1" />
								<div class="label">Soy mayor de 18 años</div>
							</label>
							<div class="label small alert alertMessage hideElement" style="margin-top: 10px;"
								id="alertAdult">Debes ser mayor de 18 años<br>para poder crear una cuenta</div>
						</div>


					</div>

					<div class="stepContent" stepContent="2">

						<div class="dynamicFilter" filterType="input">
							<div class="label title required">Correo</div>
							<input filter class="mode-fill" type="email" name="mail" id="email"
								placeholder="john.appleseed@gmail.com" required />
							<div class="label small alert alertMessage hideElement" style="margin-top: 10px;"
								id="alertEmail">El campo email no puede estar vacío</div>
						</div>

						<div class="label title required">Repetir corero</div>
						<input class="mode-fill" type="email" name="repeatMail" id="repeatMail"
							placeholder="john.appleseed@gmail.com" required />
						<div class="label small alert alertMessage hideElement" style="margin-top: 10px;"
							id="alertRepeatMail">Los emails no coinciden</div>

						<div class="dynamicFilter" filterType="input">
							<div class="sep x0"></div>

							<div class="label title required">Teléfono</div>
							<input filter class="mode-fill" type="tel" name="telefono" id="phone"
								placeholder="777888999" pattern="(?=.{9,}$)(?=.*\d).*" required />
							<div class="label small alert alertMessage hideElement" style="margin-top: 10px;"
								id="alertPhone">El campo teléfono no puede estar vacío</div>
						</div>



					</div>

					<div class="stepContent" stepContent="3">

						<div class="dynamicFilter" filterType="input">
							<div class="label title required">Contraseña</div>
							<input filter class="mode-fill hint" type="password" name="contrasena" id="password"
								placeholder="&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;"
								pattern="(?=.{8,}$)(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*\W).*"
								onkeyup="checkPasswordStrength(this.value)" onclick="setPasswordHintPosition()"
								required />
							<label for="password" id="passwordHint" class="passwordHint">
								<span>La contraseña debe contener</span>
								<p id="passwordLength">Más de 8 caracteres</p>
								<p id="passwordUpperCase">Mínimo 1 mayúscula</p>
								<p id="passwordLowerCase">Máximo 1 minúscula</p>
								<p id="passwordContainsNumber">Mínimo 1 número</p>
								<p id="passwordContainsSpecialChar">Mínimo 1 carácter especial</p>
							</label>
							<div class="label small alert alertMessage hideElement" style="margin-top: 10px;"
								id="alertPassword">El campo contraseña no puede estar vacío</div>
						</div>



						<div class="label title required">Repetir contraseña</div>
						<input class="mode-fill" type="password" name="repeatPassword" id="repeatPassword"
							placeholder="&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;"
							pattern="(?=.{8,}$)(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*\W).*" required />
						<div class="label small alert alertMessage hideElement" style="margin-top: 10px;"
							id="alertRepeatPassword">Las contraseñas nos coinciden</div>

						<div class="dynamicFilter" filterType="select">
							<div class="sep x0"></div>
							<div class="label title required">Usaré esta cuenta como</div>
							<select filter name="id_rol" class="select" id="role" required>
								<option value="1">Particular</option>
								<option value="2">Agente inmobiliario</option>
							</select>
						</div>



						<div class="label block detail small">Al crear tu cuenta aceptas los terminos de uso<br>y
							políticas de privacidad de Trobify
						</div>

					</div>

					<div class="sep"></div>

					<div class="button black block center stepAction" stepActionEnd="Crear cuenta"
						stepActionEndProcess="Registrando..." stepActionFilling="Siguiente paso">
					</div>

					<button class="button black block center invisible formSubmit" name="submit"
						type="submit"></button>

					<div class="label centered block stepBack hideElement" style="margin-top: 18px;">
						<div class="label detail pointer underline">Volver al paso anterior</div>
					</div>

				</form>
			</div>
		</div>
	</div>
	<script src="./bundle/registro.bundle.js"></script>
</body>

<script type="text/javascript">
	function checkPasswordStrength(str) {
		var length = document.getElementById("passwordLength").classList,
			upper = document.getElementById("passwordUpperCase").classList,
			lower = document.getElementById("passwordLowerCase").classList,
			number = document.getElementById("passwordContainsNumber").classList,
			special = document.getElementById("passwordContainsSpecialChar").classList;

		hasMinLength(str) ? length.add("done") : length.remove("done")
		hasUpperCase(str) ? upper.add("done") : upper.remove("done")
		hasLowerCase(str) ? lower.add("done") : lower.remove("done")
		hasNumber(str) ? number.add("done") : number.remove("done")
		hasSpecialChar(str) ? special.add("done") : special.remove("done")
	}

	function hasMinLength(str) {
		return /^.{8,}$/.test(str)
	}
	function hasUpperCase(str) {
		return /[A-Z]/.test(str)
	}
	function hasLowerCase(str) {
		return /[a-z]/.test(str)
	}
	function hasNumber(str) {
		return /[0-9]/.test(str)
	}
	function hasSpecialChar(str) {
		return /^.*[\!\¡\?\¿\@\#\$\%\^\&\*\)\(\[\]\{\}\ñ\Ñ\ç\Ç\,\+\=\.\_\-\\\/\|]/.test(str)
	}

	window.onresize = function () {
		setPasswordHintPosition()
	};

	function setPasswordHintPosition() {
		document.getElementById("passwordHint").style.marginLeft = document.getElementById("password").getBoundingClientRect().width / 2 + "px";
		document.getElementById("passwordHint").style.top = document.getElementById("password").getBoundingClientRect().top + "px";
	}

	// Step form

	window.onload = function () {
		setDefaultStepState()
	};

	var stepContent = Array.from(document.querySelectorAll("[stepContent]")),
		step = Array.from(document.querySelectorAll(".steps .step")),
		stepActionButton = document.querySelector(".stepAction"),
		formSubmitButon = document.querySelector(".formSubmit"),
		stepBackButton = document.querySelector(".stepBack"),
		stepNum = 1,
		stepEnd = step.length;

	function setDefaultStepState() {
		stepBackButton.classList.add("hideElement");
		stepActionButton.textContent = stepActionButton.getAttribute("stepActionFilling");
		step.forEach(element => {
			element.classList.remove("filled", "current");
		});
		step[0].classList.add("current");
		stepContent.forEach(element => {
			element.classList.add("hideElement");
		});
		stepContent[0].classList.remove("hideElement");
	}

	stepActionButton.addEventListener("click", stepAction, false);
	stepBackButton.addEventListener("click", stepBack, false);

	function stepAction() {

		hideErrorMessages();

		if (stepNum <= stepEnd) {

			if (stepNum === 1) {
				if (!document.querySelector("input#name").value.length > 0) {
					// Name empty
					document.querySelector("input#name").classList.add("error");
					document.querySelector("#alertName").classList.remove("hideElement");
				} else if (!document.querySelector("input#adult").checked === true) {
					// Not an adult
					document.querySelector("input#adult").classList.add("error");
					document.querySelector("#alertAdult").classList.remove("hideElement");
				} else {
					stepForward();
					return;
				}
			}

			if (stepNum === 2) {
				if (!document.querySelector("input#email").value.length > 0) {
					// Email empty
					document.querySelector("input#email").classList.add("error");
					document.querySelector("#alertEmail").classList.remove("hideElement");

				} else if (!(document.querySelector("input#repeatMail").value === document.querySelector("input#email").value)) {
					// Repeated email & email not matching
					document.querySelector("input#repeatMail").classList.add("error");
					document.querySelector("#alertRepeatMail").classList.remove("hideElement");

				} else if (!document.querySelector("input#phone").value.length > 0) {
					// Phone empty
					document.querySelector("input#phone").classList.add("error");
					document.querySelector("#alertPhone").classList.remove("hideElement");

				} else {
					stepForward();
					return;
				}
			}

			if (stepNum === 3) {
				if (!document.querySelector("input#password").value.length > 0) {
					// Password empty
					document.querySelector("input#password").classList.add("error");
					document.querySelector("#alertPassword").classList.remove("hideElement");

				} else if (!(document.querySelector("input#password").value === document.querySelector("input#repeatPassword").value)) {
					// Passwords not matching
					document.querySelector("input#repeatPassword").classList.add("error");
					document.querySelector("#alertRepeatPassword").classList.remove("hideElement");
				}
			}

		}
		if (stepNum === stepEnd) {
			var err = Array.from(document.querySelectorAll("input.error")).length > 0;
			if (!err) {
				stepActionButton.textContent = stepActionButton.getAttribute("stepActionEndProcess");
				formSubmitButon.click();
			}
		}
	}

	function hideErrorMessages() {
		Array.from(document.querySelectorAll("input.error")).forEach(v => {
			v.classList.remove("error");
		});

		Array.from(document.querySelectorAll(".alertMessage:not(hideElement)")).forEach(v => {
			v.classList.add("hideElement");
		});
	}

	function stepForward() {
		stepBackButton.classList.remove("hideElement");

		step[stepNum - 1].classList.remove("current");
		step[stepNum - 1].classList.add("filled");
		stepContent[stepNum - 1].classList.add("hideElement");

		step[stepNum].classList.add("current");
		stepContent[stepNum].classList.remove("hideElement");

		stepNum++;

		if (stepNum === stepEnd) {
			stepActionButton.textContent = stepActionButton.getAttribute("stepActionEnd");
		}
	}

	function stepBack() {
		if (stepNum > 1) {

			if (stepNum === stepEnd) {
				stepActionButton.textContent = stepActionButton.getAttribute("stepActionFilling");
			}

			step[stepNum - 2].classList.remove("filled");
			step[stepNum - 2].classList.add("current");
			stepContent[stepNum - 2].classList.remove("hideElement");

			step[stepNum - 1].classList.remove("current");
			stepContent[stepNum - 1].classList.add("hideElement");

			stepNum--;

			if (stepNum === 1) {
				stepBackButton.classList.add("hideElement");
			}
		}
	}

</script>

</html>